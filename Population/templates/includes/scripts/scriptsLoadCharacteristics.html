<script type="text/javascript">
// Flags
var data_sgdb = false;
var data_lback = false;
var data_bfram = false;
var data_appse = false;
var data_lfron = false;
var data_ffram = false;
var data_secto = false;
var data_entit = false;
//On Touch Move Mobile Version *************************************************
$('#graph_sgdb').on({
    'touchmove': function(e)
    {
        if (data_sgdb == false)
        {
            getdata('app_nsgdb');
            data_sgdb = true;
        }
    }
});
$('#graph_lback').on({
    'touchmove': function(e)
    {
        if (data_lback == false)
        {
            getdata('app_lback');
            data_lback = true;
        }
    }
});
$('#graph_appse').on({
    'touchmove': function(e)
    {
        if (data_appse == false)
        {
            getdata('app_appse');
            data_appse = true;
        }
    }
});
$('#graph_fback').on({
    'touchmove': function(e)
    {
        if (data_bfram == false)
        {
            getdata('app_bfram');
            data_bfram = true;
        }
    }
});
$('#graph_lfron').on({
    'touchmove': function(e)
    {
        if (data_lfron == false)
        {
            getdata('app_lfron');
            data_lfron = true;
        }
    }
});
$('#graph_ffram').on({
    'touchmove': function(e)
    {
        if (data_ffram == false)
        {
            getdata('app_ffram');
            data_ffram = true;
        }
    }
});
$('#graph_secto').on({
    'touchmove': function(e)
    {
        if (data_secto == false)
        {
            getdata('app_secto');
            data_secto = true;
        }
    }
});
$('#graph_entit').on({
    'touchmove': function(e)
    {
        if (data_entit == false)
        {
            getdata('app_entit');
            data_entit = true;
        }
    }
});
$(window).scroll(function()
{
    var hT = $('#graph_sgdb').offset().top;
    var hH = $('#graph_sgdb').outerHeight();

    var lT = $('#graph_lback').offset().top;
    var lH = $('#graph_lback').outerHeight();

    var sT = $('#graph_appse').offset().top;
    var sH = $('#graph_appse').outerHeight();

    var fbT = $('#graph_fback').offset().top;
    var fbH = $('#graph_fback').outerHeight();

    var lfT = $('#graph_lfron').offset().top;
    var lfH = $('#graph_lfron').outerHeight();

    var ffT = $('#graph_ffram').offset().top;
    var ffH = $('#graph_ffram').outerHeight();

    var scT = $('#graph_secto').offset().top;
    var scH = $('#graph_secto').outerHeight();

    var enT = $('#graph_entit').offset().top;
    var enH = $('#graph_entit').outerHeight();
    var wH = $(window).height();
    var wS = $(this).scrollTop();
    data_sgdb = (data_sgdb)?true:analizeScroll(wS,wH,hT,hH,'app_nsgdb');
    data_lback = (data_lback)?true:analizeScroll(wS,wH,lT,lH,'app_lback');
    data_appse = (data_appse)?true:analizeScroll(wS,wH,sT,sH,'app_appse');
    data_bfram = (data_bfram)?true:analizeScroll(wS,wH,fbT,fbH,'app_bfram');
    data_lfron = (data_lfron)?true:analizeScroll(wS,wH,lfT,lfH,'app_lfron');
    data_ffram = (data_ffram)?true:analizeScroll(wS,wH,ffT,ffH,'app_ffram');
    data_secto = (data_secto)?true:analizeScroll(wS,wH,scT,scH,'app_secto');
    data_entit = (data_entit)?true:analizeScroll(wS,wH,enT,enH,'app_entit');
});

function getdata(characteristic)
{
    var [canvas,url]=(characteristic=='app_nsgdb')?['worksc-sgdb',"{% url 'web-apps-sgdb' %}"]:
               (characteristic=='app_lback')?['worksc-lback',"{% url 'web-apps-lback' %}"]:
               (characteristic=='app_appse')?['worksc-appse',"{% url 'web-apps-appse' %}"]:
               (characteristic=='app_bfram')?['worksc-fback',"{% url 'web-apps-bfram' %}"]:
               (characteristic=='app_lfron')?['worksc-lfron',"{% url 'web-apps-lfron' %}"]:
               (characteristic=='app_ffram')?['worksc-ffram',"{% url 'web-apps-ffram' %}"]:
               (characteristic=='app_secto')?['worksc-secto',"{% url 'web-apps-secto' %}"]:
               (characteristic=='app_entit')?['worksc-entit',"{% url 'web-apps-entit' %}"]:
               ('', '');
    $.ajax({
        url: url,
        type: 'GET',
        data: {format:"json"},
        success:function(datos)
        {
            drawDataCharacteristic(datos, characteristic, canvas);
            return true;
        }
    });
}

function drawDataCharacteristic(info, characteristic, canvas)
{
    var canv = canvas;
    var labs = [];
    var data = [];
    info.forEach(elem => {
        (characteristic == 'app_nsgdb'? labs.push(elem.app_nsgdb) :
         characteristic == 'app_lback'? labs.push(elem.app_lback) :
         characteristic == 'app_appse'? labs.push(elem.app_appse) :
         characteristic == 'app_bfram'? labs.push(elem.app_bfram) :
         characteristic == 'app_lfron'? labs.push(elem.app_lfron) :
         characteristic == 'app_ffram'? labs.push(elem.app_ffram) :
         characteristic == 'app_secto'? labs.push(elem.app_secto) :
         characteristic == 'app_entit'? labs.push(elem.app_entit) : false);
        data.push(elem.Total);
    });

    var dalb = "Cantidad";
    var bgcl = ["rgba(0,255,100,0.4)",
                "rgba(239, 127, 26,0.4)",
                "rgba(0,255,0,0.4)",
                "rgba(0, 128, 128,0.4)",
                "rgba(139, 127, 26,0.4)",
                "rgba(0,200,0,0.4)",
                "rgba(50, 128, 128,0.4)"];
    var perc = true;
    var width = 0.8;
    drawBar(canv, labs, data, dalb, bgcl, perc, width, 40);
}

function analizeScroll(wS, wH, hT, hH, v)
{
    if (wS > (hT+hH-wH) && (hT > wS) && (wS+wH > hT+hH))
    {
        getdata(v);
        return true;
    }
    else
    {
        return false;
    }
}
</script>
